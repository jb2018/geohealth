## Welcome to Geohealth

Learn about geohealth. 

### What is geohealth

Geohealth brings together giscience and health.

#
# This is a Shiny web application. You can run the application by clicking
# the 'Run App' button above.
#
# This application was developed to explore spatial patterns and understand
# the processes driving them
#  
#  By: Justine Blanford, 2019

#libraries required
library(shiny)
library(spatstat)

# Define UI for application that draws a graph
ui <- fluidPage(
   
   #-----------------------------------
   
   # Application title
   titlePanel("Understanding Random Spatial Processes through Spatial Patterns"),
   helpText("The purpose of this exercise is to develop your feel for randomness",
            "by experimenting with random spatial pattern generators",
            "                                                                       "),   
   helpText("To do so you will be examining randomness in the context of spatial processes.",
            "This is a critical issue, because human beings are predisposed to seeing patterns where there are none,", 
            "and are also not good at understanding the implications of randomness." ),
   helpText("First you will examine The Independent Random Process",
            "next you will examine the Inhomogeneous Poisson Process",
            "and lastly, you will examine Interactions Between Events"),
   helpText(" "),
   
   
   
   titlePanel("The Independent Random Process"),
   helpText("The independent random process, or complete spatial randomness,",
            "operates according to the following two criteria when applied to point patterns:"),
   helpText("1.	events occur with equal probability anywhere; and"),
   helpText("2.	the place of occurrence of an event is not affected by the occurrence of other events."),
   helpText(" "),
   helpText("  "),
   helpText("Deliverable:"),
   helpText("Using examples of patterns generated by clicking on the button ",
             "comment on the following topics/questions in your Project 3 write-up:"),
   helpText("Do all these IRP/CSR patterns appear 'random'? If not, how do they seem to differ from 'random' patterns?"),
   helpText("Do some exhibit clustering of events? Or, conversely, empty regions of the map? "),
   helpText("Provide an example from your explorations, and explain how it is possible for such seemingly 'non-random' patterns to be generated by a completely random process."),
   helpText("  "),
   helpText("  "),
   
   helpText("Click the button to create a new set of plots"),
   
   # Sidebar with a slider input for number of events 
   #actionButton('goPlotIPR', 'Plot IRP'),
#   sidebarLayout(
     column(width=2,
     actionButton('goPlotIPR', 'Plot IRP')),
     
     # Show a plot of the generated distribution
     #mainPanel(
       #column(width = 6,
       plotOutput("IRPPlot3", height = 600),
       #column(width = 6,
       #plotOutput("IRPPlot4", height = 300)),

   #------------------------------------------
   
   # Application title
   titlePanel("Inhomogeneous Poisson Process"),
   helpText("Now, you are going to look at the inhomogeneous Poisson process. This is a spatial point process which generates events based on an underlying intensity that varies from place to place. In other words, it departs from IRP due to a first-order trend across the study area."),
   helpText("1.To introduce a trend, we will first need to define a function in place of the fixed intensity value of the standard Poisson process.",
            "We have done this for you with the set equations - Equation 1: pp <- rpoispp(function(x,y) {100*x + 100*y}.",
            "This tells R that the intensity of the Poisson point process varies with the x and y coordinates according to the function specified. By changing the x and y values using the sliderbar, you will be able to change the intensity.",
             "Make a few patterns based on this intensity and examine them.", 
            "You might also want to plot the density and contours of points (click the Density checkbox).",
            "Also experiment by changing the x and y values until you understand how they interact with one another."),
   helpText("2.Next experiment with the other two equations we have provided.",
            "Equation 2: Vary the intensity with the square of x and y coordinates",
            "Equation 3: Vary the intensity with with the distance from the center of the unit square "),
   helpText("Deliverable:"),
   helpText("Using examples of patterns generated using a functionally varying intensity,", 
            "comment on the following topics/questions in your Project 3 write-up:"),
   helpText("Do all these patterns appear random?"),
   helpText("How do they differ from the pure random patterns you generated in the previous section, if at all?"),  
   helpText("Can you tell the difference every time, just by visual inspection?"),
   helpText(),
   # Sidebar with a slider input for number of events 
   
   sidebarLayout(
     sidebarPanel(
       sliderInput("event_x",
                   "Click to Change x:",
                   min = 1,
                   max = 100,
                   value = 1),
       sliderInput("event_y",
                   "Click to change y:",
                   min = 1,
                   max = 100,
                   value = 1),
       
       checkboxInput('chk_densityon', "Density", FALSE),
       actionButton('goPlotIPP', 'Plot IPP'),
       
       radioButtons('equationsv', 'Equation', c('100*x + 100*y', '100*x*x + 100*y*y','200*sqrt((x-0.5)^2 + (y-0.5)^2)')),
       textOutput("tval")
       #textOutput("tval2")
     ),
     
     # Show a plot of the generated distribution
     mainPanel(
       plotOutput("IPPPlot2", height = 600)
       
     )
   ),
   
   #--------------------------------------------
   # Application title
   titlePanel("Interaction Between Events"),
   helpText(),
   helpText("Now we will introduce second-order interaction effects using a spatial process that can produce", 
            "evenly spaced patterns (rSSI and one that produces clustered patterns (rThomas)."),  
   helpText("rSSI"),
   helpText("rSSI is the Simple Sequential Inhibition process.",
            "This requires two parameters, rssI(the inhibition distance, number of events).", 
            "Events are randomly located in the study area,", 
            "but, if an event is closer to an already existing event than the inhibition distance, it is discarded.", 
            "This process continues until the required number of events have been placed.",  
            "As the inhibition distance is reduced, the resulting pattern is more like something that might be generated by IRP/CSR, although events are still not completely independent of one another."),
   
   helpText("rThomas"),
   helpText("rThomas is a clustering process. This requires three parameters, rThomas(intensity, size of clusters, number of events)",
            "By adjusting these parameters you can change how the points interact with the cluster center (intensity)"),
   helpText("Deliverable:"),
   helpText("Now, using examples of patterns generated by any of the available process models (although best to restrict yourself to one or two only!) to illustrate the discussion, comment on the following topics/questions in your Project 3 write-up:"),
   helpText("Do all these patterns appear random? How do they differ from the pure random patterns you generated in the first section, if at all?"),
   helpText("Is it always possible to spot that there is interaction between events in these patterns?"),

   # Sidebar with a slider input for number of events 

   sidebarLayout(
     sidebarPanel(
       radioButtons('interactv', 'Equation', c('rSSI', 'rThomas')),
       textOutput("tval22"),
       actionButton('goPlotIBE', 'Plot IBE'),
       checkboxInput('chk_densityon2', "Density", FALSE),
       
       conditionalPanel(
         condition = "input.interactv == 'rSSI'",
          sliderInput("e1_inhibit",
                      "Inhibition distance:",
                      min = 0.01,
                      max = 1.0,
                      value = 0.05),
           sliderInput("e1_event",
                      "No of events:",
                       min = 1,
                       max = 100,
                       value = 50)
       ),
       conditionalPanel(
         condition = "input.interactv == 'rThomas'",
         sliderInput("e1_intensity",
                     "Intensity:",
                     min = 1,
                     max = 10,
                     value = 5),
         sliderInput("e1_cluster",
                     "Size of Cluster:",
                     min = 0.01,
                     max = 1.0,
                     value = 0.25),
         sliderInput("e1_event",
                     "No of events:",
                     min = 1,
                     max = 100,
                     value = 20)
         
       )
 #      }
       
     ),
  
    # Show a plot of the generated distribution
    mainPanel(
      plotOutput("IBEPlot", height = 300)
    
    )
  )

)

# Define server logic required to draw a graph
server <- function(input, output) {
    
    #---------------------------------
    
    output$IRPPlot3 <- renderPlot({
      #generate new plot when button is pressed
      input$goPlotIPR 
      # draw the plot with 100 events
      par(mfrow=c(2, 3))
      plot(rpoispp(100))
      plot(rpoispp(100))
      plot(rpoispp(100))
      plot(rpoispp(100))
      plot(rpoispp(100))
      plot(rpoispp(100))
      
    })
    
  #  output$IRPPlot4 <- renderPlot({
      #generate new plot when button is pressed
  #    input$goPlotIPR 
      #draw the plot with 100 events
  #    plot(rpoispp(100))
   # })
    

    #----------------------------------
      
    output$IPPPlot2 <- renderPlot({
        # generate events based on input$events from ui.R
        x2    <- faithful[, 2] 
        events_x <-input$event_x
        events_y <-input$event_y
       
    #    output$tval2 <- renderText({ 
     #     paste("Equation:", input$equationsv)
      #  })
        
        #'100*x + 100*y'
        #'100*x*x + 100*y*y'
        #'200*sqrt(((x-0.5)^2) + ((y-0.5)^2))'
        
        
        if (input$equationsv == '100*x + 100*y') {
        # draw the plot with 100 events
          #plot(rpoispp(100))
          x=events_x
          y=events_y
          pp <- rpoispp(function(x,y) {100*x + 100*y})
          pp1 <- rpoispp(function(x,y) {100*x + 100*y})
          pp2 <- rpoispp(function(x,y) {100*x + 100*y})
          pp3 <- rpoispp(function(x,y) {100*x + 100*y})
        #  pp4 <- rpoispp(function(x,y) {100*x + 100*y})
        #  pp5 <- rpoispp(function(x,y) {100*x + 100*y})
          
          output$tval <- renderText({ 
             paste("Equation:","100*",x,"+","100*",y)
          })
        
        }
        
        
        if (input$equationsv == '100*x*x + 100*y*y') {
          # draw the plot with 100 events
          #plot(rpoispp(100))
          x=events_x
          y=events_y
          pp <- rpoispp(function(x,y) {100*x*x + 100*y*y})
          pp1 <- rpoispp(function(x,y) {100*x*x + 100*y*y})
          pp2 <- rpoispp(function(x,y) {100*x*x + 100*y*y})
          pp3 <- rpoispp(function(x,y) {100*x*x + 100*y*y})
                   output$tval <- renderText({ 
            paste("Equation:","100*",x,"*",x," + 100*",y,"*",y)
          })
          
        }
        
        if (input$equationsv == '200*sqrt((x-0.5)^2 + (y-0.5)^2)'){
          # draw the plot with 100 events
         # plot(rpoispp(100))
          x=events_x
          y=events_y
          pp <- rpoispp(function(x,y) {200*sqrt((x-0.5)^2 + (y-0.5)^2)})
          pp1 <- rpoispp(function(x,y) {200*sqrt((x-0.5)^2 + (y-0.5)^2)})
          pp2 <- rpoispp(function(x,y) {200*sqrt((x-0.5)^2 + (y-0.5)^2)})
          pp3 <- rpoispp(function(x,y) {200*sqrt((x-0.5)^2 + (y-0.5)^2)})
          output$tval <- renderText({ 
            paste("Equation:","200*sqrt((",x,"-0.5)^2 + (",y,"-0.5)^2)")
          })
          
        }
        
          
        input$goPlotIPP
        
        par(mfrow=c(2, 2))
        plot(pp)
        plot(pp1)
        plot(pp2)
        plot(pp3)
        #plot(pp4)
        #plot(pp5)
        
        if (input$chk_densityon==TRUE) {
          plot(density(pp))
          contour(density(pp), add=T)
          plot(density(pp1))
          contour(density(pp1), add=T)
          plot(density(pp2))
          contour(density(pp2), add=T)
          plot(density(pp3))
          contour(density(pp3), add=T)
         # plot(density(pp4))
          #contour(density(pp4), add=T)
          #plot(density(pp5))
          #contour(density(pp5), add=T)
          
        }
        

   })
    
    #----------------------------------
    #Interaction between events
    
    output$IBEPlot <- renderPlot({
      # generate events based on input$events from ui.R
      output$tval22 <- renderText({ 
        paste("Equation:", input$interactv)
      })
      
      
      if (input$interactv == 'rSSI') {
        # draw the plot with x events
        pp20 <- rSSI(input$e1_inhibit, input$e1_event)
        output$tval22 <- renderText({ 
          paste("RSSI:","inhibition",input$e1_inhibit,"Num",input$e1_event)
        })
      }
      
      
      if (input$interactv == 'rThomas'){
        # draw the plot with 100 events
        #pp <- rThomas(10, 0.1, 10)
        pp20 <- rThomas(input$e1_intensity, input$e1_cluster, input$e1_event)
        output$tval22 <- renderText({ 
          paste("rThomas")
        })
        
      }
      
      input$goPlotIBE 
      
      plot(pp20)

            if (input$chk_densityon2==TRUE) {
        plot(density(pp20))
        contour(density(pp20), add=T)
      }  
      
      
    })
    
    

}

# Run the application 
shinyApp(ui = ui, server = server)



